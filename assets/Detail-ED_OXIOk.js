import{r as d,u as E,j as e,L as y,a as p}from"./index-Cn0QZdnR.js";import{M as b}from"./Moment-SoXvcadz.js";import h from"./Toast-DweMNI2i.js";import{D as l}from"./Draft-CiT4omaO.js";function S(t,n,r){t.findEntityRanges(o=>{const i=o.getEntity();return i!==null&&r.getEntity(i).getType()==="LINK"},n)}const R=t=>{let{url:n}=t.contentState.getEntity(t.entityKey).getData();!n.startsWith("http://")&&!n.startsWith("https://")&&(n="https://"+n);const r=o=>{o.preventDefault(),window.open(n,"_blank","noopener,noreferrer")};return e.jsx("a",{href:n,style:{color:"blue",textDecoration:"underline"},onClick:r,target:"_blank",rel:"noopener noreferrer",children:t.children})},u=new l.CompositeDecorator([{strategy:S,component:R}]);function _(t){return t.getType()==="atomic"?{component:D,editable:!1}:null}function D(t){const n=t.contentState.getEntity(t.block.getEntityAt(0)),{src:r,type:o}=n.getData();let i;return o==="image"?i=e.jsx("img",{src:r,alt:"",style:{maxWidth:"50%"}}):o==="video"&&(i=e.jsxs("video",{controls:!0,style:{maxWidth:"50%"},children:[e.jsx("source",{src:r,type:"video/mp4"}),"Your browser does not support the video tag."]})),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"1rem 0"},children:i})}function T(){const[t,n]=d.useState(null),[r,o]=d.useState([]),i=E(),[c,j]=d.useState({full_name:"",email:"",comment:""}),[N,f]=d.useState(()=>l.EditorState.createEmpty(u)),x=async()=>{console.log("Fetching post with slug:",i.slug);try{const s=`post/detail/${i.slug}/`;console.log("API URL:",s);const a=await p.get(s);n(a.data);const C=a?.data?.tags?.split(",");if(o(C),a.data.description)try{let m;if(typeof a.data.description=="string")try{m=l.convertFromRaw(JSON.parse(a.data.description))}catch{m=l.ContentState.createFromText(a.data.description)}else typeof a.data.description=="object"?m=l.convertFromRaw(a.data.description):m=l.ContentState.createFromText("");f(l.EditorState.createWithContent(m,u))}catch{f(l.EditorState.createEmpty(u))}}catch(s){console.error("Failed to fetch post:",s),s.response?.status===404?h("error","پست مورد نظر یافت نشد"):h("error","خطا در بارگذاری پست. لطفاً دوباره تلاش کنید")}};d.useEffect(()=>{x()},[]);const g=s=>{j({...c,[s.target.name]:s.target.value})},v=async s=>{s.preventDefault();const a={post_id:t?.id,name:c.full_name,email:c.email,comment:c.comment};await p.post("post/comment-post/",a),h("success","فرستاده شد"),x(),j({full_name:"",email:"",comment:""})},w=async()=>{const s={user_id:1,post_id:t?.id},a=await p.post("post/like-post/",s);h("success",a.data.message),x()},k=async()=>{const s={user_id:1,post_id:t?.id},a=await p.post("post/bookmark-post/",s);h("success",a.data.message),x()};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"mt-5",style:{direction:"rtl",textAlign:"right"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs(y,{to:t?.category?.slug?`/category/${t.category.slug}`:"#",className:"badge bg-danger mb-2 text-decoration-none",children:[e.jsx("i",{className:"small fw-bold "}),t?.category?.title||"بدون دسته"]})})})})}),e.jsx("section",{className:"pt-0",style:{direction:"rtl",textAlign:"right"},children:e.jsx("div",{className:"container position-relative","data-sticky-container":"",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-2",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs("div",{className:"text-end text-lg-center mb-5",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("div",{className:"avatar avatar-xl",children:e.jsx(y,{to:`/author-profile/${t?.user?.id}`,children:e.jsx("img",{className:"avatar-img",style:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"50%"},src:t?.user?.image||"/K.webp",alt:"avatar"})})}),e.jsx("a",{href:"#",className:"h5 fw-bold text-dark text-decoration-none mt-2 mb-0 d-block",children:t?.user?.full_name}),e.jsx("p",{children:""})]}),e.jsx("hr",{className:"d-none d-lg-block "}),e.jsxs("ul",{className:"list-inline list-unstyled justify-content-end",style:{paddingRight:0},children:[e.jsxs("li",{className:"list-inline-item d-lg-block my-lg-2 text-end ms-2",style:{marginRight:0},children:[e.jsx("i",{className:"fas fa-calendar ms-1"}),b(t?.date)]}),e.jsxs("li",{className:"list-inline-item d-lg-block my-lg-2 text-end",style:{marginRight:0},children:[e.jsx("a",{href:"#",className:"text-body ",children:e.jsx("i",{className:"fas fa-heart ms-1"})}),t?.likes?.length,e.jsx("i",{className:"fas fa-eye ms-1 me-2"}),t?.view]})]}),e.jsx("style",{children:`
                    .custom-btn-padding {
                      padding-left: 31px;
                      padding-right: 31px;
                    }
                    @media (max-width: 1399px) and (min-width: 992px) {
                      .custom-btn-padding {
                        padding-left: 19px !important;
                        padding-right: 19px !important;
                      }
                    }
                    @media (max-width: 991px) {
                      .text-end.text-lg-center.mb-5 {
                        text-align: center !important;
                        display: flex !important;
                        flex-direction: column !important;
                        align-items: center !important;
                        margin-bottom: 1rem !important;
                      }
                      .list-inline.list-unstyled.justify-content-end {
                        justify-content: center !important;
                        padding-right: 0 !important;
                      }
                    }
                  `}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col",children:e.jsx("button",{onClick:k,className:"btn btn-primary ms-2 custom-btn-padding",style:{marginLeft:0},children:e.jsx("i",{className:"fas fa-bookmark"})})}),e.jsx("div",{className:"col",children:e.jsx("button",{onClick:w,className:"btn btn-success custom-btn-padding",style:{marginRight:0},children:e.jsx("i",{className:"fas fa-thumbs-up"})})})]}),e.jsx("ul",{className:"list-inline text-primary-hover mt-0 mt-lg-3 text-end",style:{paddingRight:0},children:r?.map((s,a)=>e.jsx("li",{className:"list-inline-item mt-2",children:e.jsxs("a",{className:"text-body text-decoration-none fw-bold",href:"#",children:["#",s]})},a))})]}),e.jsx("hr",{className:"d-lg-none"})]}),e.jsxs("div",{className:"col-lg-10 mb-5",children:[e.jsx("h1",{className:"text-end",style:{marginBottom:"2rem"},children:t?.title}),(t?.thumbnail||t?.image)&&e.jsx("div",{className:"mb-2 mt-2",children:e.jsx("img",{src:t?.thumbnail||t?.image,alt:"post thumbnail",style:{width:"100%",height:"auto",borderRadius:"8px"}})}),e.jsx("br",{}),e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:e.jsx(l.Editor,{editorState:N,readOnly:!0,blockRendererFn:_})}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("h3",{children:[" تعداد نظرات:",t?.comments?.length]}),t?.comments?.map((s,a)=>e.jsx("div",{className:"my-4 d-flex bg-light p-3 mb-3 rounded",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"m-0",children:s?.name}),e.jsx("span",{className:"me-3 small",children:b(s?.date)})]}),e.jsx("p",{className:"fw-bold",children:s?.comment})]})},a))]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("h3",{className:"fw-bold",children:"کامنت بگذارید"}),e.jsx("small",{children:"ایمیل شما منتشر نخواهد شد. فیلد‌های ستاره‌دار اجباریست"}),e.jsxs("form",{className:"row g-3 mt-2",onSubmit:v,children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"نام *"}),e.jsx("input",{onChange:g,name:"full_name",value:c.full_name,type:"text",className:"form-control","aria-label":"First name"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"ایمیل *"}),e.jsx("input",{onChange:g,name:"email",value:c.email,type:"email",className:"form-control"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"نظر خود را بنویسید *"}),e.jsx("textarea",{onChange:g,name:"comment",value:c.comment,className:"form-control",rows:4})]}),e.jsx("div",{className:"col-12",children:e.jsxs("button",{type:"submit",className:"btn btn-outline-primary",children:["ارسال ",e.jsx("i",{className:"fas fa-paper-plane"})]})})]})]})]})]})})})]})}export{T as default};
