import{r as i,j as s,a as r}from"./index-Z6RSLzn0.js";import{u as _}from"./useUserData-DXE5Qzuu.js";import m from"./Toast-DDFf3xAJ.js";import{M as S}from"./Moment-96b0345b.js";function k(){const[c,u]=i.useState([]),[p,x]=i.useState({}),[o,b]=i.useState({}),[t,j]=i.useState({}),g=_(),y=g?.user_id,f=g?.is_staff||g?.can_delete_comment||!1,h=async()=>{const e=await r.get(`author/dashboard/comment-list/${y}/`),a=await r.get("contact-message/list/"),d=[...e?.data,...a?.data]?.slice().sort((l,E)=>new Date(E.date)-new Date(l.date));u(d)},w=(e,a)=>{x(n=>({...n,[e]:a}))},N=async e=>{try{const a=c.find(l=>l.id===e);let n;a?.message?(n=await r.post("contact-message/reply/",{contact_message_id:a.id,response:p[e]||""}),j(l=>({...l,[e]:!0}))):n=await r.post("author/dashboard/reply-comment/",{comment_id:e,reply:p[e]||""}),console.log(n.data),await h(),window.dispatchEvent(new CustomEvent("contactMessagesUpdated")),m("success","پاسخ فرستاده شد"),x(l=>({...l,[e]:""}));const d=document.getElementById(`collapseExample${e}`);d&&(window.bootstrap?.Collapse.getInstance(d)||new window.bootstrap.Collapse(d)).hide()}catch(a){console.log(a)}},C=e=>{b(a=>a[e]?a:{...a,[e]:!0})},v=async e=>{if(window.confirm("آیا مطمئن هستید که می‌خواهید این نظر را حذف کنید؟"))try{const a=c.find(n=>n.id===e);if(!a){m("error","نظر یافت نشد");return}a.message?(await r.post("author/dashboard/delete-contact-message/",{contact_message_id:e}),m("success","پیام تماس با موفقیت حذف شد")):(await r.post("author/dashboard/delete-comment/",{comment_id:e}),m("success","نظر با موفقیت حذف شد")),await h(),window.dispatchEvent(new CustomEvent("commentDeleted",{detail:{commentId:e,isContactMessage:!!a.message}}))}catch(a){console.error(a),m("error","حذف نظر با شکست مواجه شد")}};return i.useEffect(()=>{h()},[]),s.jsx(s.Fragment,{children:s.jsx("section",{className:"pt-5 pb-5",style:{direction:"rtl"},children:s.jsx("div",{className:"container",children:s.jsx("div",{className:"row mt-0 mt-md-4",children:s.jsx("div",{className:"col-lg-12 col-md-8 col-12",children:s.jsxs("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header d-lg-flex align-items-center justify-content-between",children:s.jsx("div",{className:"mb-3 mb-lg-0",children:s.jsx("h3",{className:"mb-0",children:"بخش نظرات"})})}),s.jsx("div",{className:"card-body",children:s.jsx("ul",{className:"list-group list-group-flush",children:c?.map((e,a)=>s.jsx("li",{className:"list-group-item p-4 shadow rounded-3 mb-4",style:{fontWeight:o[e.id]||e?.reply||e?.message&&(e?.responded||t[e.id])?"normal":"bold",backgroundColor:o[e.id]||e?.reply||e?.message&&(e?.responded||t[e.id])?"#e3e3e3":"transparent"},children:s.jsxs("div",{className:"d-flex",children:[s.jsx("img",{src:e?.image||"/K.webp",alt:"avatar",className:"rounded-circle avatar-lg",style:{width:"70px",height:"70px",borderRadius:"50%",objectFit:"cover"}}),s.jsxs("div",{style:{marginRight:"1rem",marginTop:"0.5rem"},children:[s.jsx("div",{className:"d-flex align-items-center justify-content-between",children:s.jsxs("div",{children:[s.jsxs("h4",{className:"mb-2",children:["از طرف ",e?.name," "]}),s.jsxs("span",{children:[S(e.date)," (",e?.email,")"]})]})}),s.jsxs("div",{className:"mt-2",children:[e?.subject&&s.jsxs("p",{className:"mt-1",style:{fontWeight:o[e.id]||e?.reply||e?.message&&(e?.responded||t[e.id])?"normal":"bold",color:"#555"},children:["موضوع: ",e.subject," ",e?.message&&s.jsx("span",{className:"badge bg-warning text-dark ms-2 me-1",children:"پیام تماس"})]}),s.jsxs("p",{className:"mt-2",style:{fontWeight:o[e.id]||e?.reply||e?.message&&(e?.responded||t[e.id])?"normal":"bold"},children:[s.jsx("span",{style:{marginLeft:"0.5rem"},children:e?.message?"پیام:":"نظر:"}),e?.comment||e?.message]}),s.jsx("hr",{}),s.jsxs("p",{className:"mt-2",style:{fontWeight:o[e.id]||e?.reply||e?.message&&(e?.responded||t[e.id])?"normal":"bold",color:e?.message&&(e?.responded||t[e.id])?"green":e?.reply?"inherit":"red"},children:[s.jsx("span",{style:{marginLeft:"0.5rem",color:e?.message&&(e?.responded||t[e.id])?"green":"inherit"},children:"پاسخ:"}),e?.message&&(e?.responded||t[e.id])?"پیام ارسال شد":e?.reply||"بدون پاسخ"]}),s.jsxs("p",{children:[!(e?.message&&(e?.responded||t[e.id]))&&s.jsx("button",{className:e?.reply||e?.message&&(e?.responded||t[e.id])?"btn btn-secondary":"btn btn-outline-secondary",type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapseExample${e.id.toString()}`,"aria-expanded":"false","aria-controls":`collapseExample${e.id.toString()}`,onClick:()=>C(e.id),style:{marginLeft:".5rem"},children:e?.reply?"ویرایش پاسخ":"پاسخ دهید"}),f&&s.jsx("button",{className:e?.reply||e?.message&&(e?.responded||t[e.id])?"btn btn-danger":"btn btn-outline-danger",onClick:()=>v(e.id),children:"حذف نظر"})]}),s.jsx("div",{className:"collapse",id:`collapseExample${e.id.toString()}`,children:s.jsx("div",{className:"card card-body",children:s.jsxs("div",{children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:`replyTextarea${e.id}`,className:"form-label",children:"پاسخ خود را بنویسید"}),s.jsx("textarea",{onChange:n=>w(e.id,n.target.value),value:p[e.id]||"",name:"",id:`replyTextarea${e.id}`,cols:"30",className:"form-control",rows:"4"})]}),s.jsxs("button",{onClick:()=>N(e.id),type:"button",className:"btn btn-primary",children:["ارسال ",s.jsx("i",{className:"fas fa-paper-plane",children:" "})]})]})})})]})]})]})},e.id))})})]})})})})})})}export{k as default};
