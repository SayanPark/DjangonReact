import{r as m,e as $,u as J,j as e,a as b,S as w,k as G}from"./index-AOJz8hy7.js";import{u as Y}from"./useUserData-CR4t9Tm2.js";import g from"./Toast-BbuGwk1I.js";import{D as o}from"./Draft-B3p_Top0.js";/* empty css              */typeof window<"u"&&!window.setImmediate&&(window.setImmediate=G);function q(s,i,p){s.findEntityRanges(d=>{const l=d.getEntity();return l!==null&&p.getEntity(l).getType()==="LINK"},i)}const z=s=>{let{url:i}=s.contentState.getEntity(s.entityKey).getData();!i.startsWith("http://")&&!i.startsWith("https://")&&(i="https://"+i);const p=d=>{d.preventDefault(),window.open(i,"_blank","noopener,noreferrer")};return e.jsx("a",{href:i,style:{color:"blue",textDecoration:"underline"},onClick:p,target:"_blank",rel:"noopener noreferrer",children:s.children})},j=new o.CompositeDecorator([{strategy:q,component:z}]);function Q(s){const i=s.contentState.getEntity(s.block.getEntityAt(0)),{src:p,type:d}=i.getData();let l;return d==="image"?l=e.jsx("img",{src:p,alt:"",style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"}}):d==="video"&&(l=e.jsxs("video",{controls:!0,style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"},children:[e.jsx("source",{src:p,type:"video/mp4"}),"مرورگر شما از ویدئو پشتیبانی نمی‌کند، مجددا تلاش کنید"]})),l}function X(s){return s.getType()==="atomic"?{component:Q,editable:!1}:null}function ne(){const[s,i]=m.useState({title:"",category:"",tags:"",status:""}),[p,d]=m.useState(null),[l,u]=m.useState(o.EditorState.createEmpty(j)),[S,C]=m.useState([]),[v,y]=m.useState(!1),[E,T]=m.useState(!1),[L,U]=m.useState(""),[F,D]=m.useState(""),N=Y()?.user_id||null,I=$(),k=J(),R=async()=>{try{const a=await b.get("post/category/list/");C(a.data)}catch(a){console.log(a)}},W=async()=>{try{const t=(await b.get(`author/dashboard/post-detail/${N}/${k.id}/`)).data;if(i({title:t.title,category:t.category===null||isNaN(parseInt(t.category))?"":t.category,tags:t.tags,status:t.status}),t.image&&d(t.image),t.description){let n=function(c){let r=c;for(let h=0;h<3&&typeof r=="string";h++)try{r=JSON.parse(r)}catch{break}return r};try{const c=n(t.description);if(c&&c.blocks&&Array.isArray(c.blocks))u(o.EditorState.createWithContent(o.convertFromRaw(c),j));else{const r=typeof c=="object"&&c.blocks?c.blocks.map(h=>h.text).join(`
`):t.description;u(o.EditorState.createWithContent(o.ContentState.createFromText(r)))}}catch{const r=typeof t.description=="string"?t.description:JSON.stringify(t.description);u(o.EditorState.createWithContent(o.ContentState.createFromText(r)))}}else u(o.EditorState.createEmpty(j))}catch(a){console.log(a)}};m.useEffect(()=>{R(),W()},[]);const x=a=>{i({...s,[a.target.name]:a.target.value})},A=a=>{u(a)},B=(a,t)=>{const r=l.getCurrentContent().createEntity(t,"IMMUTABLE",{src:a,type:t}).getLastCreatedEntityKey(),h=o.AtomicBlockUtils.insertAtomicBlock(l,r," ");u(h)},K=(a,t)=>{const n=new FileReader;n.onload=()=>{B(n.result,t)},n.readAsDataURL(a)},f=a=>{const t=a.target.files[0];if(t){const n=t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":null;n?K(t,n):g("error","نوع فایل پشتیبانی نمی‌شود. لطفاً یک تصویر یا ویدیو آپلود کنید.")}},M=a=>{const t=a.target.files[0];t&&(d(URL.createObjectURL(t)),i({...s,image:t}))},P=()=>{w.fire({title:"افزودن لینک",html:'<input id="swal-link-text" class="swal2-input" placeholder="متن لینک"><input id="swal-link-url" class="swal2-input" placeholder="آدرس لینک">',focusConfirm:!1,preConfirm:()=>{const a=document.getElementById("swal-link-text").value,t=document.getElementById("swal-link-url").value;return!a||!t?(w.showValidationMessage("لطفا متن لینک و آدرس لینک را وارد کنید"),!1):{linkText:a,linkUrl:t}}}).then(a=>{if(a.isConfirmed){const{linkText:t,linkUrl:n}=a.value;if(t&&n){const r=l.getCurrentContent().createEntity("LINK","MUTABLE",{url:n}),h=r.getLastCreatedEntityKey(),V=l.getSelection();let O=o.Modifier.replaceText(r,V,t,null,h);const _=o.EditorState.push(l,O,"insert-characters");u(_)}}})},H=async a=>{if(a.preventDefault(),y(!0),!s.status){g("error","لطفا وضعیت پست را مشخص نمایید"),y(!1);return}try{const t=JSON.stringify(o.convertToRaw(l.getCurrentContent())),n=new FormData;n.append("title",s.title),n.append("category",s.category),n.append("tags",s.tags),n.append("post_status",s.status),n.append("description",t),s.image&&n.append("image",s.image),await b.put(`author/dashboard/post-detail/${N}/${k.id}/`,n,{headers:{"Content-Type":"multipart/form-data"}}),g("success","پست با موفقیت به‌روزرسانی شد"),I("/dashboard/posts/")}catch(t){console.error(t),g("error","خطا در به‌روزرسانی پست")}finally{y(!1)}};return e.jsx(e.Fragment,{children:e.jsx("section",{className:"pt-5 pb-5",style:{direction:"rtl"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row mt-0 mt-md-4",children:e.jsx("div",{className:"col-lg-12 col-md-8 col-12",children:e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-4 py-lg-6 bg-primary rounded-3",style:{position:"relative"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"offset-lg-1 col-lg-10 col-md-12 col-12",children:e.jsx("div",{className:"d-lg-flex align-items-center justify-content-start",children:e.jsx("div",{className:"",children:e.jsx("h1",{className:"text-white mb-1",children:"ویرایش پست"})})})})})})}),e.jsxs("form",{onSubmit:H,className:"pb-8 mt-5",children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header border-bottom px-4 py-3",children:e.jsx("h4",{className:"mb-0",children:"ویرایش اطلاعات"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"نمایش عکس"}),e.jsx("img",{style:{width:"100%",height:"330px",objectFit:"cover",borderRadius:"10px"},className:"mb-4",src:p||"https://www.eclosio.ong/wp-content/uploads/2018/08/default.png",alt:""}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"عکس کاور پست"}),e.jsx("input",{onChange:M,name:"image",id:"postTHumbnail",className:"form-control",type:"file"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"عنوان"}),e.jsx("input",{className:"form-control",onChange:x,name:"title",type:"text",placeholder:"",value:s.title}),e.jsx("small",{children:"عنوان مقاله را بنویسید"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"زیرمجموعه مقاله"}),e.jsxs("select",{className:"form-select",onChange:x,name:"category",value:s.category,children:[e.jsx("option",{value:"",children:"-------------"}),S?.map((a,t)=>e.jsx("option",{value:a?.id,children:a?.title},t))]}),e.jsx("small",{children:"انتخاب کردن دپارتمان مربوط به مقاله‌تان به مخاطبان کمک می‌کند تا راحت‌تر به مقاله دسترسی داشته باشند"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"مقاله"}),e.jsx("br",{}),e.jsx("small",{className:"mb-3",children:"مقاله خود را اینجا بنویسید"}),e.jsxs("div",{className:"mb-3 d-flex flex-column",style:{border:"1px solid #ccc",height:"200px",padding:"10px"},children:[e.jsxs("div",{className:"mb-3 d-flex gap-2",style:{flexShrink:0},children:[e.jsx("input",{id:"fileUploadImage",type:"file",accept:"image/*",onChange:f,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadImage",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-image"})}),e.jsx("input",{id:"fileUploadVideo",type:"file",accept:"video/*",onChange:f,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadVideo",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-camera-video"})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-lg",onClick:P,style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-link-45deg"})}),E&&e.jsxs("div",{className:"input-group mt-2",children:[e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"متن لینک را وارد کنید",value:F,onChange:a=>D(a.target.value)}),e.jsx("input",{type:"text",className:"form-control",placeholder:"آدرس لینک را وارد کنید",value:L,onChange:a=>U(a.target.value)}),e.jsx("button",{type:"button",className:"btn btn-primary mt-2",children:"تایید"}),e.jsx("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>T(!1),children:"لغو"})]})]}),e.jsx("hr",{}),e.jsx("div",{style:{flexGrow:1,overflowY:"auto"},children:e.jsx(o.Editor,{editorState:l,onChange:A,blockRendererFn:X,style:{direction:"rtl",minHeight:"100%"}})})]})]})]}),e.jsx("div",{className:"mb-3",style:{display:"none"},children:e.jsx("input",{id:"fileUpload",type:"file",accept:"image/*,video/*",onChange:f})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"وضعیت مقاله"}),e.jsxs("select",{className:"form-select",name:"status",onChange:x,id:"",value:s.status,children:[e.jsx("option",{value:"",children:"-------"}),e.jsx("option",{value:"Active",children:"فعال"}),e.jsx("option",{value:"Draft",children:"پیش‌ نویس"}),e.jsx("option",{value:"Disabled",children:"غیرفعال"})]})]}),e.jsx("label",{className:"form-label",children:"کلیدواژه‌ها"}),e.jsx("input",{onChange:x,name:"tags",className:"form-control",type:"text",placeholder:"کلیدواژه های مربوط به مقاله را بنویسید",value:s.tags}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"در حال ذخیره...":"ذخیره تغییرات"})})]})]})})})})})})}export{ne as default};
