import{e as _,r as n,j as e,a as u}from"./index-zz9Ul-ek.js";import{u as I}from"./useUserData-CE-7Ul1h.js";import b from"./Toast-Cw7rC109.js";function D(){const j=_(),[a,d]=n.useState({image:null,first_name:"",last_name:"",about:"",bio:"",email:""}),[m,h]=n.useState(""),[N,g]=n.useState(!1),[p,r]=n.useState(!0),[x,c]=n.useState(""),f=I()?.user_id,v=async()=>{try{const l=await u.get(`user/profile/${f}/`),t=(l.data.full_name||"").split(" "),i=t.shift()||"",F=t.join(" ")||"";d({...l.data,first_name:i,last_name:F,email:l.data.email||""})}catch(l){console.log(l)}},y=l=>{const s=l.target.files[0];if(s){if(s.type==="image/jpeg"||s.type==="image/png")r(!0),c("");else{r(!1),c("عکس باید یکی از دوفرمت jpg یا png باشد."),d({...a,image:null}),h("");return}d({...a,[l.target.name]:s});const i=new FileReader;i.onload=()=>{h(i.result)},i.readAsDataURL(s)}};n.useEffect(()=>{(()=>{let s=m||a.image;if(!s){r(!0),c("");return}const t=new Image;t.onload=()=>{t.naturalWidth>800?(r(!1),c("طول عکس بزرگتر از 800 پیکسل نباشد.")):(r(!0),c(""))},t.onerror=()=>{r(!1),c("خطا در بارگذاری عکس.")},t.src=s})()},[m,a.image]);const w=async()=>{if(!p){b("error",x||"عکس نامعتبر است.");return}g(!0);const l=await u.get(`user/profile/${f}/`),s=new FormData;a.image&&a.image!==l.data.image&&s.append("image",a.image);const t=`${a.first_name}${a.last_name?" "+a.last_name:""}`;s.append("full_name",t),s.append("about",a.about),s.append("bio",a.bio),s.append("email",a.email);try{const i=await u.patch(`user/profile/${f}/`,s,{headers:{"Content-Type":"multipart/form-data"}});b("success","پروفایل شما بروزرسانی شد"),j("/")}catch(i){console.log(i)}finally{g(!1)}},o=l=>{d({...a,[l.target.name]:l.target.value})};return n.useEffect(()=>{async function l(){await v()}l()},[]),e.jsx(e.Fragment,{children:e.jsx("section",{className:"pt-5 pb-5",dir:"rtl",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row mt-0 mt-md-4",children:e.jsx("div",{className:"col-lg-12 col-md-8 col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"mb-0",children:"مشخصات پروفایل"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-lg-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"d-flex align-items-center mb-4 mb-lg-0",children:[(()=>{const s=m||((t=>typeof t=="string"&&t.trim()!==""&&t!=="http://127.0.0.1:8000/media/default/default-user.jpg")(a.image)?a.image:"/DjangonReact/K.webp");return p?e.jsx("img",{src:s,id:"img-uploaded",className:"avatar-xl rounded-circle",alt:"avatar",style:{width:"100px",height:"100px",borderRadius:"50%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",backgroundColor:"#f8d7da",color:"#721c24",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"5px",fontSize:"12px"},children:x})})(),e.jsxs("div",{className:"me-3",children:[e.jsx("h4",{className:"mb-0",children:"عکس پروفایل"}),e.jsx("input",{type:"file",className:"form-control mt-3",name:"image",onChange:y,id:""})]}),e.jsxs("div",{className:"mt-3 me-5 d-flex flex-column",children:[e.jsx("label",{htmlFor:"email",className:"mb-1 fw-bold",children:"ایمیل"}),e.jsx("input",{type:"email",id:"email",name:"email",className:"form-control",placeholder:"ایمیل خود را وارد کنید",value:a.email||"",onChange:o})]})]})}),e.jsx("hr",{className:"my-5"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-0 fw-bold",children:[e.jsx("i",{className:"fas fa-user-gear ms-2"}),"اطلاعات شخصی"]}),e.jsx("p",{className:"mb-4 mt-2",children:"اطلاعات خود را اینجا ویرایش کنید"}),e.jsxs("div",{className:"row gx-3",children:[e.jsxs("div",{className:"mb-3 col-12 col-md-6",children:[e.jsx("label",{className:"form-label",htmlFor:"fname",children:"نام"}),e.jsx("input",{onChange:o,name:"first_name",type:"text",id:"fname",className:"form-control",placeholder:"نام",required:"",value:a.first_name||""}),e.jsx("div",{className:"invalid-feedback",children:"نام خود را بنویسید."})]}),e.jsxs("div",{className:"mb-3 col-12 col-md-6",children:[e.jsx("label",{className:"form-label",htmlFor:"lname",children:"نام خانوادگی"}),e.jsx("input",{onChange:o,name:"last_name",type:"text",id:"lname",className:"form-control",placeholder:"نام خانوادگی",required:"",value:a.last_name||""}),e.jsx("div",{className:"invalid-feedback",children:"نام خانوادگی خود را بنویسید."})]}),e.jsxs("div",{className:"mb-3 col-12 col-md-12",children:[e.jsx("label",{className:"form-label",htmlFor:"fname",children:"حوزه فعالیت"}),e.jsx("input",{onChange:o,name:"bio",type:"text",id:"fname",className:"form-control",placeholder:"در چه زمینه‌ای فعالیت می‌کنید؟",required:"",value:a.bio||""}),e.jsx("div",{className:"invalid-feedback",children:"نام خود را بنویسید."})]}),e.jsxs("div",{className:"mb-3 col-12 col-md-12",children:[e.jsx("label",{className:"form-label",htmlFor:"lname",children:"توضیحات"}),e.jsx("textarea",{onChange:o,name:"about",placeholder:"بیشتر درباره خودتان توضیح دهید...",id:"",cols:"30",rows:"5",className:"form-control",value:a.about||""}),e.jsx("div",{className:"invalid-feedback",children:"نام خانوادگی خود را بنویسید."})]}),e.jsx("div",{className:"col-12 mt-4",children:N===!0?e.jsxs("button",{disabled:!0,className:"btn btn-lg btn-secondary w-100 mt-2",type:"button",children:["درحال بروزرسانی ",e.jsx("i",{className:"fas fa-spinner fa-spin"})]}):e.jsxs("button",{onClick:w,className:"btn btn-primary",type:"button",children:["بروزرسانی پروفایل ",e.jsx("i",{className:"fas fa-check-circle"})]})})]})]})]})]})})})})})})}export{D as default};
