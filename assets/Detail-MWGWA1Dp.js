import{r as p,u as F,j as e,L as w,a as h}from"./index-BRrys8nQ.js";import{M as k}from"./Moment-BrWZvzPO.js";import x from"./Toast-CZgnu7HI.js";import{D as o}from"./Draft-BurxG7d7.js";function _(t,n,c){t.findEntityRanges(m=>{const l=m.getEntity();return l!==null&&c.getEntity(l).getType()==="LINK"},n)}const D=t=>{let{url:n}=t.contentState.getEntity(t.entityKey).getData();!n.startsWith("http://")&&!n.startsWith("https://")&&(n="https://"+n);const c=m=>{m.preventDefault(),window.open(n,"_blank","noopener,noreferrer")};return e.jsx("a",{href:n,style:{color:"blue",textDecoration:"underline"},onClick:c,target:"_blank",rel:"noopener noreferrer",children:t.children})},j=new o.CompositeDecorator([{strategy:_,component:D}]);function L(t){return t.getType()==="atomic"?{component:A,editable:!1}:null}function A(t){const n=t.contentState.getEntity(t.block.getEntityAt(0)),{src:c,type:m}=n.getData();let l;return m==="image"?l=e.jsx("img",{src:c,alt:"",style:{maxWidth:"50%"}}):m==="video"&&(l=e.jsxs("video",{controls:!0,style:{maxWidth:"50%"},children:[e.jsx("source",{src:c,type:"video/mp4"}),"Your browser does not support the video tag."]})),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"1rem 0"},children:l})}function W(){const[t,n]=p.useState(null),[c,m]=p.useState([]),l=F(),[d,y]=p.useState({full_name:"",email:"",comment:""}),[C,b]=p.useState(()=>o.EditorState.createEmpty(j)),[N,u]=p.useState([]),g=async()=>{console.log("Fetching post with slug:",l.slug);try{const s=`post/detail/${l.slug}/`;console.log("API URL:",s);const a=await h.get(s);n(a.data);const r=a?.data?.tags?.split(",");if(m(r),a.data.description)try{let i;if(typeof a.data.description=="string")try{i=o.convertFromRaw(JSON.parse(a.data.description))}catch{i=o.ContentState.createFromText(a.data.description)}else typeof a.data.description=="object"?i=o.convertFromRaw(a.data.description):i=o.ContentState.createFromText("");b(o.EditorState.createWithContent(i,j))}catch{b(o.EditorState.createEmpty(j))}}catch(s){console.error("Failed to fetch post:",s),s.response?.status===404?x("error","پست مورد نظر یافت نشد"):x("error","خطا در بارگذاری پست. لطفاً دوباره تلاش کنید")}},v=async()=>{if(t?.id)try{const s=await h.get(`post/comments/${t.id}/`);console.log("Fetched comments with replies:",s.data);let a=s.data;typeof a=="object"&&!Array.isArray(a)&&(a=a.results||a.comments||[]);const r=a.map(i=>({...i,reply:i.reply||i.replies||null}));u(r)}catch(s){if(console.error("Failed to fetch comments:",s),t?.comments){const a=t.comments.map(r=>({...r,reply:r.reply||r.replies||null}));u(a)}else u([])}};p.useEffect(()=>{g()},[]),p.useEffect(()=>{t?.id&&v()},[t?.id]);const f=s=>{y({...d,[s.target.name]:s.target.value})},E=async s=>{s.preventDefault();const a={post_id:t?.id,name:d.full_name,email:d.email,comment:d.comment};await h.post("post/comment-post/",a),x("success","فرستاده شد"),g(),v(),y({full_name:"",email:"",comment:""})},S=async()=>{const s={user_id:1,post_id:t?.id},a=await h.post("post/like-post/",s);x("success",a.data.message),g()},R=async()=>{const s={user_id:1,post_id:t?.id},a=await h.post("post/bookmark-post/",s);x("success",a.data.message),g()};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"mt-5",style:{direction:"rtl",textAlign:"right"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs(w,{to:t?.category?.slug?`/category/${t.category.slug}`:"#",className:"badge bg-danger mb-2 text-decoration-none",children:[e.jsx("i",{className:"small fw-bold "}),t?.category?.title||"بدون دسته"]})})})})}),e.jsx("section",{className:"pt-0",style:{direction:"rtl",textAlign:"right"},children:e.jsx("div",{className:"container position-relative","data-sticky-container":"",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-2",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs("div",{className:"text-center text-lg-center mb-5",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("div",{className:"avatar avatar-xl",children:e.jsx(w,{to:`/author-profile/${t?.user?.id}`,children:e.jsx("img",{className:"avatar-img",style:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"50%"},src:t?.user?.image||"/K.webp",alt:"avatar",onError:s=>{s.target.src!=="/K.webp"&&(s.target.src="/K.webp")}})})}),e.jsx("a",{href:"#",className:"h5 fw-bold text-dark text-decoration-none mt-2 mb-0 d-block",children:t?.user?.full_name}),e.jsx("p",{children:""})]}),e.jsx("hr",{className:"d-none d-lg-block "}),e.jsxs("ul",{className:"list-inline list-unstyled justify-content-end",style:{paddingRight:0},children:[e.jsxs("li",{className:"list-inline-item d-lg-block my-lg-2 text-end ms-2",style:{marginRight:0},children:[e.jsx("i",{className:"fas fa-calendar ms-1"}),k(t?.date)]}),e.jsxs("li",{className:"list-inline-item d-lg-block my-lg-2 text-end",style:{marginRight:0},children:[e.jsx("a",{href:"#",className:"text-body ",children:e.jsx("i",{className:"fas fa-heart ms-1"})}),t?.likes?.length,e.jsx("i",{className:"fas fa-eye ms-1 me-2"}),t?.view]})]}),e.jsx("style",{children:`
                    .custom-btn-padding {
                      padding-left: 31px;
                      padding-right: 31px;
                    }
                    @media (max-width: 1399px) and (min-width: 992px) {
                      .custom-btn-padding {
                        padding-left: 19px !important;
                        padding-right: 19px !important;
                      }
                    }
                    @media (max-width: 991px) {
                      .text-end.text-lg-center.mb-5 {
                        text-align: center !important;
                        display: flex !important;
                        flex-direction: column !important;
                        align-items: center !important;
                        margin-bottom: 1rem !important;
                      }
                      .list-inline.list-unstyled.justify-content-end {
                        justify-content: center !important;
                        padding-right: 0 !important;
                      }
                    }
                  `}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col",children:e.jsx("button",{onClick:R,className:"btn btn-primary ms-2 custom-btn-padding",style:{marginLeft:0},children:e.jsx("i",{className:"fas fa-bookmark"})})}),e.jsx("div",{className:"col",children:e.jsx("button",{onClick:S,className:"btn btn-success custom-btn-padding",style:{marginRight:0},children:e.jsx("i",{className:"fas fa-thumbs-up"})})})]}),e.jsx("ul",{className:"list-inline text-primary-hover mt-0 mt-lg-3 text-end",style:{paddingRight:0},children:c?.map((s,a)=>e.jsx("li",{className:"list-inline-item mt-2",children:e.jsxs("a",{className:"text-body text-decoration-none fw-bold",href:"#",children:["#",s]})},a))})]}),e.jsx("hr",{className:"d-lg-none"})]}),e.jsxs("div",{className:"col-lg-10 mb-5",children:[e.jsx("h1",{className:"text-end",style:{marginBottom:"2rem"},children:t?.title}),(t?.thumbnail||t?.image)&&e.jsx("div",{className:"mb-2 mt-2",children:e.jsx("img",{src:t?.thumbnail||t?.image,alt:"post thumbnail",style:{width:"100%",height:"auto",borderRadius:"8px"},onError:s=>{const a=`
                        <div style="
                          width: 100%;
                          height: 300px;
                          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                          background-size: 200% 100%;
                          animation: shimmer 1.5s infinite;
                          border-radius: 8px;
                          position: relative;
                          overflow: hidden;
                        ">
                          <style>
                            @keyframes shimmer {
                              0% { background-position: -200% 0; }
                              100% { background-position: 200% 0; }
                            }
                          </style>
                        </div>
                      `,r=s.target.parentElement;r.innerHTML=a}})}),e.jsx("br",{}),e.jsx("div",{style:{whiteSpace:"pre-wrap"},children:e.jsx(o.Editor,{editorState:C,readOnly:!0,blockRendererFn:L})}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("h3",{children:[" تعداد نظرات:",N?.length]}),N?.map((s,a)=>e.jsx("div",{className:"my-4 d-flex bg-light p-3 mb-3 rounded",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"m-0",children:s?.name}),e.jsx("span",{className:"me-3 small",children:k(s?.date)})]}),e.jsx("p",{className:"fw-bold",children:s?.comment}),s?.reply&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("p",{className:"mb-1 text-muted small",children:"پاسخ نویسنده:"}),e.jsx("p",{className:"fw-bold text-primary",children:s?.reply})]})]})},a))]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("h3",{className:"fw-bold",children:"کامنت بگذارید"}),e.jsx("small",{children:"ایمیل شما منتشر نخواهد شد. فیلد‌های ستاره‌دار اجباریست"}),e.jsxs("form",{className:"row g-3 mt-2",onSubmit:E,children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"نام *"}),e.jsx("input",{onChange:f,name:"full_name",value:d.full_name,type:"text",className:"form-control","aria-label":"First name"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"ایمیل *"}),e.jsx("input",{onChange:f,name:"email",value:d.email,type:"email",className:"form-control"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"نظر خود را بنویسید *"}),e.jsx("textarea",{onChange:f,name:"comment",value:d.comment,className:"form-control",rows:4})]}),e.jsx("div",{className:"col-12",children:e.jsxs("button",{type:"submit",className:"btn btn-outline-primary",children:["ارسال ",e.jsx("i",{className:"fas fa-paper-plane"})]})})]})]})]})]})})})]})}export{W as default};
