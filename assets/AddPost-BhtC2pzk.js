import{r,e as _,j as e,a as N,S as y,k as P}from"./index-Cp3nbvAN.js";import{u as V}from"./useUserData-BTjUTq3u.js";import m from"./Toast-BwwSfMOs.js";import{D as p}from"./Draft-QM6_KsH_.js";/* empty css              */typeof window<"u"&&!window.setImmediate&&(window.setImmediate=P);function O(n,l,c){n.findEntityRanges(d=>{const a=d.getEntity();return a!==null&&c.getEntity(a).getType()==="LINK"},l)}const G=n=>{let{url:l}=n.contentState.getEntity(n.entityKey).getData();!l.startsWith("http://")&&!l.startsWith("https://")&&(l="https://"+l);const c=d=>{d.preventDefault(),window.open(l,"_blank","noopener,noreferrer")};return e.jsx("a",{href:l,style:{color:"blue",textDecoration:"underline"},onClick:c,target:"_blank",rel:"noopener noreferrer",children:n.children})},J=new p.CompositeDecorator([{strategy:O,component:G}]);function Y(n){const l=n.contentState.getEntity(n.block.getEntityAt(0)),{src:c,type:d}=l.getData();let a;return d==="image"?a=e.jsx("img",{src:c,alt:"",style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"}}):d==="video"&&(a=e.jsxs("video",{controls:!0,style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"},children:[e.jsx("source",{src:c,type:"video/mp4"}),"مرورگر شما از ویدئو پشتیبانی نمی‌کند، مجددا تلاش کنید"]})),a}function q(n){return n.getType()==="atomic"?{component:Y,editable:!1}:null}function ee(){const[n,l]=r.useState({title:"",category:parseInt(""),tags:"",status:""}),[c,d]=r.useState(null),[a,h]=r.useState(p.EditorState.createEmpty(J)),[v,w]=r.useState([]),[k,o]=r.useState(!1),[C,S]=r.useState(!1),[E,L]=r.useState(""),[T,U]=r.useState(""),j=V()?.user_id||null,I=_(),F=async()=>{try{const t=await N.get("post/category/list/");w(t.data)}catch(t){console.log(t)}};r.useEffect(()=>{F()},[]);const u=t=>{l({...n,[t.target.name]:t.target.value})},D=t=>{h(t)},R=(t,s)=>{const i=new FileReader;i.onload=()=>{const g=a.getCurrentContent().createEntity(s,"IMMUTABLE",{src:i.result,type:s}).getLastCreatedEntityKey(),b=p.AtomicBlockUtils.insertAtomicBlock(a,g," ");h(b)},i.readAsDataURL(t)},x=t=>{const s=t.target.files[0];if(s){const i=s.type.startsWith("image/")?"image":s.type.startsWith("video/")?"video":null;i?R(s,i):m("error","نوع فایل پشتیبانی نمی‌شود. لطفاً یک تصویر یا ویدیو آپلود کنید.")}},W=t=>{const s=t.target.files[0];s&&(d(URL.createObjectURL(s)),l({...n,image:s}))},A=()=>{y.fire({title:"افزودن لینک",html:'<input id="swal-link-text" class="swal2-input" placeholder="متن لینک"><input id="swal-link-url" class="swal2-input" placeholder="آدرس لینک">',focusConfirm:!1,preConfirm:()=>{const t=document.getElementById("swal-link-text").value,s=document.getElementById("swal-link-url").value;return!t||!s?(y.showValidationMessage("لطفا متن لینک و آدرس لینک را وارد کنید"),!1):{linkText:t,linkUrl:s}}}).then(t=>{if(t.isConfirmed){const{linkText:s,linkUrl:i}=t.value;if(s&&i){const f=a.getCurrentContent().createEntity("LINK","MUTABLE",{url:i}),g=f.getLastCreatedEntityKey(),b=a.getSelection();let M=p.Modifier.replaceText(f,b,s,null,g);const H=p.EditorState.push(a,M,"insert-characters");h(H)}}})},B=async t=>{if(t.preventDefault(),o(!0),!n.title){m("error","لطفا عنوان را وارد کنید"),o(!1);return}if(!n.category){m("error","لطفا زیرمجموعه مقاله را انتخاب کنید"),o(!1);return}if(!a.getCurrentContent().hasText()){m("error","لطفا مقاله را وارد کنید"),o(!1);return}if(!n.tags){m("error","لطفا کلیدواژه‌ها را وارد کنید"),o(!1);return}if(!n.image){m("error","لطفا تصویر شاخص را انتخاب کنید"),o(!1);return}if(!j){m("error","کاربر احراز هویت نشده است"),o(!1);return}if(!n.status){m("error","لطفا وضعیت پست را مشخص نمایید"),o(!1);return}const s=new FormData;s.append("user_id",j),s.append("title",n.title),s.append("description",JSON.stringify(p.convertToRaw(a.getCurrentContent()))),s.append("tags",n.tags),s.append("category",n.category),s.append("post_status",n.status),n.image&&s.append("image",n.image);try{const i=await N.post("author/dashboard/post-create/",s,{headers:{"Content-Type":"multipart/form-data"}});console.log(i.data),o(!1),y.fire({icon:"success",title:"پست با موفقیت ساخته شد"}),I("/posts/")}catch(i){console.log(i),o(!1)}};return e.jsx(e.Fragment,{children:e.jsx("section",{className:"pt-5 pb-5",style:{direction:"rtl"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row mt-0 mt-md-4",children:e.jsx("div",{className:"col-lg-12 col-md-8 col-12",children:e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-4 py-lg-6 bg-primary rounded-3",style:{position:"relative"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"offset-lg-1 col-lg-10 col-md-12 col-12",children:e.jsx("div",{className:"d-lg-flex align-items-center justify-content-start",children:e.jsx("div",{className:"",children:e.jsx("h1",{className:"text-white mb-1",children:"پست جدید بسازید"})})})})})})}),e.jsxs("form",{onSubmit:B,className:"pb-8 mt-5",children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header border-bottom px-4 py-3",children:e.jsx("h4",{className:"mb-0",children:"اضافه کردن اطلاعات"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"نمایش عکس"}),e.jsx("img",{style:{width:"100%",height:"330px",objectFit:"cover",borderRadius:"10px"},className:"mb-4",src:c||"https://www.eclosio.ong/wp-content/uploads/2018/08/default.png",alt:""}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"عکس کاور پست"}),e.jsx("input",{onChange:W,name:"image",id:"postTHumbnail",className:"form-control",type:"file"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"عنوان"}),e.jsx("input",{className:"form-control",onChange:u,name:"title",type:"text",placeholder:""}),e.jsx("small",{children:"عنوان مقاله را بنویسید"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"زیرمجموعه مقاله"}),e.jsxs("select",{className:"form-select",onChange:u,name:"category",children:[e.jsx("option",{value:"",children:"-------------"}),v?.map((t,s)=>e.jsx("option",{value:t?.id,children:t?.title},s))]}),e.jsx("small",{children:"انتخاب کردن دپارتمان مربوط به مقاله‌تان به مخاطبان کمک می‌کند تا راحت‌تر به مقاله دسترسی داشته باشند"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"مقاله"}),e.jsx("br",{}),e.jsx("small",{children:"مقاله خود را اینجا بنویسید"}),e.jsxs("div",{className:"mb-3 d-flex flex-column",style:{border:"1px solid #ccc",height:"300px",padding:"10px"},children:[e.jsxs("div",{className:"mb-3 d-flex gap-2",style:{flexShrink:0},children:[e.jsx("input",{id:"fileUploadImage",type:"file",accept:"image/*",onChange:x,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadImage",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-image"})}),e.jsx("input",{id:"fileUploadVideo",type:"file",accept:"video/*",onChange:x,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadVideo",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-camera-video"})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-lg",onClick:A,style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-link-45deg"})}),C&&e.jsxs("div",{className:"input-group mt-2",children:[e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"متن لینک را وارد کنید",value:T,onChange:t=>U(t.target.value)}),e.jsx("input",{type:"text",className:"form-control",placeholder:"آدرس لینک را وارد کنید",value:E,onChange:t=>L(t.target.value)}),e.jsx("button",{type:"button",className:"btn btn-primary mt-2",children:" تایید "}),e.jsx("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>S(!1),children:"لغو"})]})]}),e.jsx("hr",{}),e.jsx("div",{style:{flexGrow:1,overflowY:"auto"},children:e.jsx(p.Editor,{editorState:a,onChange:D,blockRendererFn:q,style:{direction:"rtl",minHeight:"100%"}})})]})]}),e.jsx("div",{className:"mb-3",style:{display:"none"},children:e.jsx("input",{id:"fileUpload",type:"file",accept:"image/*,video/*",onChange:x})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"وضعیت مقاله"}),e.jsxs("select",{className:"form-select",name:"status",onChange:u,id:"",value:n.status,children:[e.jsx("option",{value:"",children:"-------"}),e.jsx("option",{value:"Active",children:"فعال"}),e.jsx("option",{value:"Draft",children:"پیش‌ نویس"}),e.jsx("option",{value:"Disabled",children:"غیرفعال"})]})]}),e.jsx("label",{className:"form-label",children:"کلیدواژه‌ها"}),e.jsx("input",{onChange:u,name:"tags",className:"form-control",type:"text",placeholder:"کلیدواژه های مربوط به مقاله را بنویسید"})]})]}),k===!0?e.jsxs("button",{disabled:!0,className:"btn btn-lg btn-secondary w-100 mt-2",type:"submit",children:["درحال پست سازی ",e.jsx("i",{className:"fas fa-spinner fa-spin"})]}):e.jsxs("button",{className:"btn btn-lg btn-success w-100 mt-2",type:"submit",children:["ایجاد پست ",e.jsx("i",{className:"fas fa-check-circle"})]})]})]})})})})})})}export{ee as default};
