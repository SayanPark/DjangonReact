import{j as e,r as c,e as X,u as G,a as j,S,k as Y}from"./index-BaH4DU17.js";import{u as q}from"./useUserData-Cw7kWPsM.js";import f from"./Toast-BAT32Aiu.js";import{D as l}from"./Draft-DtUIx4gk.js";/* empty css              */const z=({width:a="100%",height:i="160px"})=>e.jsxs("div",{style:{width:a,height:i,backgroundColor:"#f0f0f0",borderRadius:"4px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%)",animation:"shimmer 1.5s infinite"}}),e.jsx("style",{jsx:!0,children:`
        @keyframes shimmer {
          0% {
            transform: translateX(-100%);
          }
          100% {
            transform: translateX(100%);
          }
        }
      `})]});typeof window<"u"&&!window.setImmediate&&(window.setImmediate=Y);function Q(a,i,m){a.findEntityRanges(d=>{const p=d.getEntity();return p!==null&&m.getEntity(p).getType()==="LINK"},i)}const Z=a=>{let{url:i}=a.contentState.getEntity(a.entityKey).getData();!i.startsWith("http://")&&!i.startsWith("https://")&&(i="https://"+i);const m=d=>{d.preventDefault(),window.open(i,"_blank","noopener,noreferrer")};return e.jsx("a",{href:i,style:{color:"blue",textDecoration:"underline"},onClick:m,target:"_blank",rel:"noopener noreferrer",children:a.children})},v=new l.CompositeDecorator([{strategy:Q,component:Z}]);function ee(a){const i=a.contentState.getEntity(a.block.getEntityAt(0)),{src:m,type:d}=i.getData();let p;return d==="image"?p=e.jsx("img",{src:m,alt:"",style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"}}):d==="video"&&(p=e.jsxs("video",{controls:!0,style:{maxWidth:"50%",maxHeight:"300px",objectFit:"contain"},children:[e.jsx("source",{src:m,type:"video/mp4"}),"مرورگر شما از ویدئو پشتیبانی نمی‌کند، مجددا تلاش کنید"]})),p}function te(a){return a.getType()==="atomic"?{component:ee,editable:!1}:null}function oe(){const[a,i]=c.useState({title:"",category:"",tags:"",status:""}),[m,d]=c.useState(null),[p,C]=c.useState(!1),[u,g]=c.useState(l.EditorState.createEmpty(v)),[E,T]=c.useState([]),[N,y]=c.useState(!1),[I,L]=c.useState(!1),[U,F]=c.useState(""),[D,R]=c.useState(""),k=q()?.user_id||null,W=X(),w=G(),B=async()=>{try{const s=await j.get("post/category/list/");T(s.data)}catch(s){console.log(s)}},A=async()=>{try{const t=(await j.get(`author/dashboard/post-detail/${k}/${w.id}/`)).data;if(i({title:t.title,category:t.category===null||isNaN(parseInt(t.category))?"":t.category,tags:t.tags,status:t.status}),t.image&&d(t.image),t.description){let n=function(r){let o=r;for(let h=0;h<3&&typeof o=="string";h++)try{o=JSON.parse(o)}catch{break}return o};try{const r=n(t.description);if(r&&r.blocks&&Array.isArray(r.blocks))g(l.EditorState.createWithContent(l.convertFromRaw(r),v));else{const o=typeof r=="object"&&r.blocks?r.blocks.map(h=>h.text).join(`
`):t.description;g(l.EditorState.createWithContent(l.ContentState.createFromText(o)))}}catch{const o=typeof t.description=="string"?t.description:JSON.stringify(t.description);g(l.EditorState.createWithContent(l.ContentState.createFromText(o)))}}else g(l.EditorState.createEmpty(v))}catch(s){console.log(s)}};c.useEffect(()=>{B(),A()},[]);const x=s=>{i({...a,[s.target.name]:s.target.value})},K=s=>{g(s)},M=(s,t)=>{const o=u.getCurrentContent().createEntity(t,"IMMUTABLE",{src:s,type:t}).getLastCreatedEntityKey(),h=l.AtomicBlockUtils.insertAtomicBlock(u,o," ");g(h)},P=(s,t)=>{const n=new FileReader;n.onload=()=>{M(n.result,t)},n.readAsDataURL(s)},b=s=>{const t=s.target.files[0];if(t){const n=t.type.startsWith("image/")?"image":t.type.startsWith("video/")?"video":null;n?P(t,n):f("error","نوع فایل پشتیبانی نمی‌شود. لطفاً یک تصویر یا ویدیو آپلود کنید.")}},H=s=>{const t=s.target.files[0];t&&(d(URL.createObjectURL(t)),i({...a,image:t}))},V=()=>{S.fire({title:"افزودن لینک",html:'<input id="swal-link-text" class="swal2-input" placeholder="متن لینک"><input id="swal-link-url" class="swal2-input" placeholder="آدرس لینک">',focusConfirm:!1,preConfirm:()=>{const s=document.getElementById("swal-link-text").value,t=document.getElementById("swal-link-url").value;return!s||!t?(S.showValidationMessage("لطفا متن لینک و آدرس لینک را وارد کنید"),!1):{linkText:s,linkUrl:t}}}).then(s=>{if(s.isConfirmed){const{linkText:t,linkUrl:n}=s.value;if(t&&n){const o=u.getCurrentContent().createEntity("LINK","MUTABLE",{url:n}),h=o.getLastCreatedEntityKey(),_=u.getSelection();let $=l.Modifier.replaceText(o,_,t,null,h);const J=l.EditorState.push(u,$,"insert-characters");g(J)}}})},O=async s=>{if(s.preventDefault(),y(!0),!a.status){f("error","لطفا وضعیت پست را مشخص نمایید"),y(!1);return}try{const t=JSON.stringify(l.convertToRaw(u.getCurrentContent())),n=new FormData;n.append("title",a.title),n.append("category",a.category),n.append("tags",a.tags),n.append("post_status",a.status),n.append("description",t),a.image&&n.append("image",a.image),await j.put(`author/dashboard/post-detail/${k}/${w.id}/`,n,{headers:{"Content-Type":"multipart/form-data"}}),f("success","پست با موفقیت به‌روزرسانی شد"),W("/dashboard/posts/")}catch(t){console.error(t),f("error","خطا در به‌روزرسانی پست")}finally{y(!1)}};return e.jsx(e.Fragment,{children:e.jsx("section",{className:"pt-5 pb-5",style:{direction:"rtl"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row mt-0 mt-md-4",children:e.jsx("div",{className:"col-lg-12 col-md-8 col-12",children:e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-4 py-lg-6 bg-primary rounded-3",style:{position:"relative"},children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"offset-lg-1 col-lg-10 col-md-12 col-12",children:e.jsx("div",{className:"d-lg-flex align-items-center justify-content-start",children:e.jsx("div",{className:"",children:e.jsx("h1",{className:"text-white mb-1",children:"ویرایش پست"})})})})})})}),e.jsxs("form",{onSubmit:O,className:"pb-8 mt-5",children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header border-bottom px-4 py-3",children:e.jsx("h4",{className:"mb-0",children:"ویرایش اطلاعات"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"نمایش عکس"}),p?e.jsx(z,{width:"100%",height:"330px",style:{borderRadius:"10px",marginBottom:"1.5rem"}}):e.jsx("img",{style:{width:"100%",height:"330px",objectFit:"cover",borderRadius:"10px"},className:"mb-4",src:m||"https://www.eclosio.ong/wp-content/uploads/2018/08/default.png",alt:"",onError:()=>C(!0)}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"postTHumbnail",className:"form-label",children:"عکس کاور پست"}),e.jsx("input",{onChange:H,name:"image",id:"postTHumbnail",className:"form-control",type:"file"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"عنوان"}),e.jsx("input",{className:"form-control",onChange:x,name:"title",type:"text",placeholder:"",value:a.title}),e.jsx("small",{children:"عنوان مقاله را بنویسید"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"زیرمجموعه مقاله"}),e.jsxs("select",{className:"form-select",onChange:x,name:"category",value:a.category,children:[e.jsx("option",{value:"",children:"-------------"}),E?.map((s,t)=>e.jsx("option",{value:s?.id,children:s?.title},t))]}),e.jsx("small",{children:"انتخاب کردن دپارتمان مربوط به مقاله‌تان به مخاطبان کمک می‌کند تا راحت‌تر به مقاله دسترسی داشته باشند"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"مقاله"}),e.jsx("br",{}),e.jsx("small",{className:"mb-3",children:"مقاله خود را اینجا بنویسید"}),e.jsxs("div",{className:"mb-3 d-flex flex-column",style:{border:"1px solid #ccc",height:"200px",padding:"10px"},children:[e.jsxs("div",{className:"mb-3 d-flex gap-2",style:{flexShrink:0},children:[e.jsx("input",{id:"fileUploadImage",type:"file",accept:"image/*",onChange:b,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadImage",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-image"})}),e.jsx("input",{id:"fileUploadVideo",type:"file",accept:"video/*",onChange:b,style:{display:"none"}}),e.jsx("label",{htmlFor:"fileUploadVideo",className:"btn btn-outline-secondary btn-lg",style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-camera-video"})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-lg",onClick:V,style:{outline:"none",boxShadow:"none",border:"none",padding:0},children:e.jsx("i",{className:"bi bi-link-45deg"})}),I&&e.jsxs("div",{className:"input-group mt-2",children:[e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"متن لینک را وارد کنید",value:D,onChange:s=>R(s.target.value)}),e.jsx("input",{type:"text",className:"form-control",placeholder:"آدرس لینک را وارد کنید",value:U,onChange:s=>F(s.target.value)}),e.jsx("button",{type:"button",className:"btn btn-primary mt-2",children:"تایید"}),e.jsx("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>L(!1),children:"لغو"})]})]}),e.jsx("hr",{}),e.jsx("div",{style:{flexGrow:1,overflowY:"auto"},children:e.jsx(l.Editor,{editorState:u,onChange:K,blockRendererFn:te,style:{direction:"rtl",minHeight:"100%"}})})]})]})]}),e.jsx("div",{className:"mb-3",style:{display:"none"},children:e.jsx("input",{id:"fileUpload",type:"file",accept:"image/*,video/*",onChange:b})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"وضعیت مقاله"}),e.jsxs("select",{className:"form-select",name:"status",onChange:x,id:"",value:a.status,children:[e.jsx("option",{value:"",children:"-------"}),e.jsx("option",{value:"Active",children:"فعال"}),e.jsx("option",{value:"Draft",children:"پیش‌ نویس"}),e.jsx("option",{value:"Disabled",children:"غیرفعال"})]})]}),e.jsx("label",{className:"form-label",children:"کلیدواژه‌ها"}),e.jsx("input",{onChange:x,name:"tags",className:"form-control",type:"text",placeholder:"کلیدواژه های مربوط به مقاله را بنویسید",value:a.tags}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N,children:N?"در حال ذخیره...":"ذخیره تغییرات"})})]})]})})})})})})}export{oe as default};
